
{
"name":"ivre",
"description":"Install IVRE github.com/ivre/ivre",
"install": [
"sudo sh -c id",
"sudo apt -y --no-install-recommends install mongodb python3-pymongo python3-crypto python3-bottle apache2 libapache2-mod-wsgi-py3",
"wget  https://download.dokuwiki.org/src/dokuwiki/dokuwiki-stable.tgz",
"sudo mkdir -p /var/www/html/dokuwiki",
"sudo tar xzf dokuwiki-stable.tgz -C /var/www/html/dokuwiki/ --strip-components=1",
"git clone https://github.com/ivre/ivre",
"cd ivre",
"python3 setup.py build",
"sudo python3 setup.py install",
"sudo sh -c 'cd /var/www/html'",
"sudo sh -c 'rm index.html'",
"sudo sh -c 'ln -s /usr/local/share/ivre/web/static/* .'",
"sudo sh -c 'cd /var/lib/dokuwiki/data/pages'",
"sudo sh -c 'ln -s /usr/local/share/ivre/dokuwiki/doc'",
"sudo sh -c 'cd /var/lib/dokuwiki/data/media'",
"sudo sh -c 'ln -s /usr/local/share/ivre/dokuwiki/media/logo.png'",
"sudo sh -c 'ln -s /usr/local/share/ivre/dokuwiki/media/doc'",
"sudo sh -c 'cd /usr/share/dokuwiki'",
"sudo sh -c 'patch -p0 < /usr/local/share/ivre/dokuwiki/backlinks.patch'",
"sudo sh -c 'cd /etc/apache2/mods-enabled'",
"for m in rewrite.load wsgi.conf wsgi.load ; do",
"  [ -L $m ] || sudo ln -s ../mods-available/$m ; done",
"sudo echo 'Alias /cgi \"/usr/local/share/ivre/web/wsgi/app.wsgi\"' | sudo tee -a /etc/apache2/conf-enabled/ivre.conf",
"sudo echo '<Location /cgi>' | sudo tee -a /etc/apache2/conf-enabled/ivre.conf",
"sudo echo 'SetHandler wsgi-script' | sudo tee -a /etc/apache2/conf-enabled/ivre.conf",
"sudo echo 'Options +ExecCGI' | sudo tee -a /etc/apache2/conf-enabled/ivre.conf",
"sudo echo 'Require all granted' | sudo tee -a  /etc/apache2/conf-enabled/ivre.conf",
"sudo echo '</Location>' | sudo tee -a  /etc/apache2/conf-enabled/ivre.conf",
"echo QWxpYXNNYXRjaCBeL2Rva3V3aWtpL3NpdGVzL1teL10rJCAgICAgIC91c3Ivc2hhcmUvZG9rdXdpa2kvCkFsaWFzTWF0Y2ggXi9kb2t1d2lraS9zaXRlcy9bXi9dKy8oLiopJCAvdXNyL3NoYXJlL2Rva3V3aWtpLyQxCkFsaWFzICAgICAgL2Rva3V3aWtpICAgICAgICAgICAgICAgICAgICAvdXNyL3NoYXJlL2Rva3V3aWtpLwoKPERpcmVjdG9yeSAvdXNyL3NoYXJlL2Rva3V3aWtpLz4KT3B0aW9ucyArRm9sbG93U3ltTGlua3MKQWxsb3dPdmVycmlkZSBBbGwKb3JkZXIgYWxsb3csZGVueQoJQWxsb3cgZnJvbSBsb2NhbGhvc3QgMTI3LjAuMC4xIDo6MQoKICAgICAgICA8SWZNb2R1bGUgbW9kX3Jld3JpdGUuYz4KCiAgICAgICAgICAgICAgICAjIFVuY29tbWVudCB0byBpbXBsZW1lbnQgc2VydmVyLXNpZGUgVVJMIHJld3JpdGluZwogICAgICAgICAgICAgICAgIyAoY2YuIDxodHRwOi8vd3d3LmRva3V3aWtpLm9yZy9jb25maWc6dXNlcmV3cml0ZT4pLgogICAgICAgICAgICAgICAgICAgICAgICAjIERvICpub3QqIG1peCB0aGF0IHdpdGggbXVsdGlzaXRlIQogICAgICAgICAgICAgICAgI1Jld3JpdGVFbmdpbmUgb24KICAgICAgICAgICAgICAgICNSZXdyaXRlQmFzZSAvZG9rdXdpa2kKICAgICAgICAgICAgICAgICNSZXdyaXRlUnVsZSBebGliICAgICAgICAgICAgICAgICAgICAgIC0gW0xdCiAgICAgICAgICAgICAgICAjUmV3cml0ZVJ1bGUgXmRva3UucGhwICAgICAgICAgICAgICAgICAtIFtMXQogICAgICAgICAgICAgICAgI1Jld3JpdGVSdWxlIF5mZWVkLnBocCAgICAgICAgICAgICAgICAgLSBbTF0KICAgICAgICAgICAgICAgICNSZXdyaXRlUnVsZSBeX21lZGlhLyguKikgICAgICAgICAgICAgIGxpYi9leGUvZmV0Y2gucGhwP21lZGlhPSQxICBbUVNBLExdCiAgICAgICAgICAgICAgICAjUmV3cml0ZVJ1bGUgXl9kZXRhaWwvKC4qKSAgICAgICAgICAgICBsaWIvZXhlL2RldGFpbC5waHA/bWVkaWE9JDEgW1FTQSxMXQogICAgICAgICAgICAgICAgI1Jld3JpdGVSdWxlIF5fZXhwb3J0LyhbXi9dKykvKC4qKSAgICAgZG9rdS5waHA/ZG89ZXhwb3J0XyQxJmlkPSQyIFtRU0EsTF0KICAgICAgICAgICAgICAgICNSZXdyaXRlUnVsZSBeJCAgICAgICAgICAgICAgICAgICAgICAgIGRva3UucGhwICBbTF0KICAgICAgICAgICAgICAgICNSZXdyaXRlUnVsZSAoLiopICAgICAgICAgICAgICAgICAgICAgIGRva3UucGhwP2lkPSQxICBbUVNBLExdCiAgICAgICAgPC9JZk1vZHVsZT4KPC9EaXJlY3Rvcnk+Cgo8RGlyZWN0b3J5IC91c3Ivc2hhcmUvZG9rdXdpa2kvYmluPgogICAgICAgIFJlcXVpcmUgYWxsIGRlbmllZAo8L0RpcmVjdG9yeT4KCjxEaXJlY3RvcnkgL3Zhci9saWIvZG9rdXdpa2kvZGF0YT4KICAgICAgICBSZXF1aXJlIGFsbCBkZW5pZWQKPC9EaXJlY3Rvcnk+Cg== | base64 -d  | sudo tee -a /etc/dokuwiki/apache.conf",
"sudo sed -i 's/^\\(\\s*\\)#Rewrite/\\1Rewrite/' /etc/dokuwiki/apache.conf",
"sudo echo 'WEB_GET_NOTEPAD_PAGES = \"localdokuwiki\"' | sudo tee -a /etc/ivre.conf",
"sudo service apache2 reload",
"yes | ivre ipinfo --init",
"yes | ivre scancli --init",
"yes | ivre view --init",
"yes | ivre flowcli --init",
"yes | sudo ivre runscansagentdb --init",
"sudo ivre ipdata --download"
    ],
    "uninstall":[
        "sudo apt-get purge xfce4 xfce4-goodies ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal -y"
    ],
    "notes":"Install Complete. You should be able to safely ingore errors above. If you run into issue SSH into the instance and run apt-get install dokuwiki"
}
