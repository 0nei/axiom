{
"name":"ivre",
"description":"Install IVRE Framework (https://github.com/ivre/ivre) Client, Database and Web Dashboard",
"install": [
"echo 'Waiting for cloud-init to finish, this can take a few minutes please be patient...'",
"/usr/bin/cloud-init status --wait",  
"sudo apt-get -q update",
"sudo apt-get -qy --no-install-recommends install python3-pymongo mongodb python3-crypto python3-bottle libapache2-mod-wsgi-py3 python3-cryptography python3-setuptools python3-bottle python3-openssl ca-certificates git -y",
"git clone https://github.com/ivre/ivre",
"sudo service apache2 stop",
"sudo service mongodb stop",
"cd ivre/ && python3 setup.py build && sudo python3 setup.py install && cd /home/op/",
"sudo mkdir -m 1777 /home/op/ivre/var_{lib,log}_mongodb",
"docker run -d --name ivredb -p 127.0.0.1:27017:27017 --hostname ivredb --volume /home/op/ivre/var_lib_mongodb:/var/lib/mongodb  --volume /home/op/ivre/var_lib_mongod/var_log_mongodb:/var/log/mongodb ivre/db",
"sudo apt-get -qy --no-install-recommends install rsync screen ipython3 openssl tesseract-ocr libfreetype6 libfontconfig1 fonts-dejavu imagemagick ffmpeg s3270 patch bash-completion bzip2 python3-pil nfdump python3-pymongo  python3-crypto python3-bottle apache2 libapache2-mod-wsgi-py3 ",
"wget https://nmap.org/dist/nmap-7.92.tgz -O nmap.tar.gz",
"sudo apt-get -qy --no-install-recommends install build-essential libssl-dev flex bison",
"tar zxf nmap.tar.gz  && cd nmap-7.92",
"sudo ./configure --without-ndiff --without-zenmap --without-nping  --without-ncat --without-nmap-update    --with-libpcap=included && sudo make && sudo make install && cd /home/op",
"sudo apt-get -qy --no-install-recommends install gnupg wget",
"echo 'deb http://download.opensuse.org/repositories/security:/zeek/Debian_11/ /' | sudo tee -a /etc/apt/sources.list.d/zeek.list",
"wget -qO - https://download.opensuse.org/repositories/security:zeek/Debian_11/Release.key | sudo apt-key add - ",
"sudo apt-get -q update && sudo apt-get -qy --no-install-recommends install zeek",
"wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-1.9.8-linux-x86_64.tar.bz2 && tar jxf phantomjs-1.9.8-linux-x86_64.tar.bz2 phantomjs-1.9.8-linux-x86_64/bin/phantomjs",
"sudo mv phantomjs-1.9.8-linux-x86_64/bin/phantomjs /usr/local/bin/",
"sudo cp /home/op/ivre/nmap_scripts/* /usr/local/share/nmap/scripts",
"sudo cp /home/op/ivre/nmap_scripts/* /home/op/nmap-7.92/scripts",
"cd /home/op/nmap-7.92/ && sudo ./nmap --script-update",
"sudo nmap --script-update",
"sudo service nginx stop",
"sudo service apache2 stop",
"yes | ivre ipinfo --init",
"yes | ivre scancli --init",
"yes | ivre view --init",
"yes | ivre flowcli --init",
"yes | sudo ivre runscansagentdb --init",
"sudo ivre ipdata --download",
"echo ''",  
"echo 'Testing database by conducting NMAP scan against: 45.33.32.156 (scanme.nmap.org)'",
"cd /home/op/",
"/home/op/go/bin/nuclei -ut",
"echo http://45.33.32.156 | /home/op/go/bin/nuclei -o scanme.nmap.org.json --json",
"cat scanme.nmap.org.json |  jq 'with_entries(if .key == \"template-id\" then .key = \"template\" else . end)' | jq 'with_entries(if .key == \"matched-at\" then .key = \"matched\" else . end)' | jq -c | tee corrrected-scanme.nmap.org.json",
"echo 45.33.32.156 | tee /home/op/scanme.nmap.org",
"sudo ivre runscans -f  /home/op/scanme.nmap.org --output=XMLFork",
"echo 'Importing scan result'",
"ivre scan2db -r /home/op/scans/",
"ivre scan2db corrrected-scanme.nmap.org.json",
"ivre db2view nmap",
"echo ''",
"echo 'The IVRE / DRUNK Dynamic Recon of UNKnown Network Install Complete'",
"echo 'To start the dashbaord:'",
"echo \"run axiom-exec 'docker run -d --name ivreweb --hostname ivreweb --link ivredb:ivredb --publish 80:80 ivre/web' '$(hostname)'\"",
"echo 'Then the dashboard will be publicly reachable at:'",
"dig @ns1-1.akamaitech.net ANY whoami.akamai.net +short | sed 's/^/http:/'"
    ],
    "uninstall":[
        ""
    ],
    "notes":"Install Complete. Dashboard not running."
}
